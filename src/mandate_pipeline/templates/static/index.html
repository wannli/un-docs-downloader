{% extends "base.html" %}

{% block title %}Mandate Pipeline{% endblock %}

{% block nav_index %}./index.html{% endblock %}
{% block nav_documents %}./documents/index.html{% endblock %}

{% block content %}
<!-- Hero -->
<div class="mb-12">
    <h1 class="text-4xl font-bold text-gray-900 tracking-tight">Mandate Pipeline</h1>
    <p class="mt-4 text-lg text-muted max-w-2xl leading-relaxed">
        Automated analysis of United Nations General Assembly documents, tracking signals across plenary and committee proposals and resolutions.
    </p>
</div>

<!-- Matrix: Patterns × Signals -->
<div>
    <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4">Signal Matrix</h2>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead>
                <tr>
                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-500 bg-gray-50 rounded-tl-lg">Pattern</th>
                    {% for check in checks %}
                    <th class="text-center py-3 px-4 text-sm font-medium text-gray-500 bg-gray-50 {% if loop.last %}rounded-tr-lg{% endif %}">
                        <a href="./signals/{{ check.signal|lower|replace(' ', '-') }}.html" class="hover:text-un-blue transition-colors">
                            {{ check.signal }}
                        </a>
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for pattern in patterns %}
                {% set pattern_slug = pattern.name|lower|replace(' ', '_')|replace('.', '')|replace('(', '')|replace(')', '') %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="py-4 px-4">
                        <a href="./patterns/{{ pattern_slug }}.html" class="font-medium text-gray-900 hover:text-un-blue transition-colors">
                            {{ pattern.name }}
                        </a>
                    </td>
                    {% for check in checks %}
                    {% set count = matrix.get(pattern.name, {}).get(check.signal, 0) %}
                    {% set signal_slug = check.signal|lower|replace(' ', '-') %}
                    <td class="text-center py-4 px-4">
                        {% if count > 0 %}
                        <a href="./matrix/{{ pattern_slug }}_{{ signal_slug }}.html" 
                           class="inline-flex items-center justify-center min-w-[2rem] px-2 py-1 rounded-full text-sm font-medium transition-all hover:scale-110
                            {% if 'agenda' in check.signal|lower %}bg-blue-50 text-blue-700 hover:bg-blue-100
                            {% elif 'pga' in check.signal|lower %}bg-purple-50 text-purple-700 hover:bg-purple-100
                            {% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                            {{ count }}
                        </a>
                        {% else %}
                        <span class="text-gray-300">—</span>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


{% endblock %}

{% block footer %}
Generated {{ generated_at }} · <a href="./data.json" class="text-un-blue hover:underline">JSON API</a>
{% endblock %}
